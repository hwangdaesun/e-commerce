# 비즈니스 요구사항

## 1. 이해관계자 요구사항

### 고객
- 상품을 쉽게 찾고 구매할 수 있어야 함
- 실시간 재고 정보를 확인할 수 있어야 함
- 인기 상품을 빠르게 파악할 수 있어야 함

## 2. 주문 프로세스

```
상품 선택
  ↓
장바구니
  ↓
재고 확인
  ↓
재고 있음? ──NO──> 재고 부족 알림
  ↓ YES
재고 차감
  ↓
쿠폰 적용
  ↓
결제 처리
  ↓
주문 완료
  ↓
주문한 장바구니 항목 제거
  ↓
데이터 플랫폼 전송
```

## 3. 기능적 요구사항

### 3.1 상품 관리

#### 3.1.1 상품 조회
- 상품 목록: 커서 기반 페이징 (무한 스크롤), 최신순 정렬
- 상품 상세: 상품 ID를 통한 정보 조회
- 재고 확인: 실시간 재고 조회
- 재고가 0인 상품도 목록에 표시

#### 3.1.2 인기 상품 조회
- 집계 기준: 최근 3일간 판매량
- 결과: 상위 5개 (최대 10개까지 조회 가능)

### 3.2 주문/결제 시스템

#### 3.2.1 장바구니 기능
- 상품 수량 지정하여 장바구니 담기
- 장바구니 상품 수량 수정
- 사용자별 장바구니 관리 (인증 구현은 하지 않음)

#### 3.2.2 재고 확인 및 차감
- 재고 확인 시점:
  - 장바구니에 담을 때 재고 확인
  - 결제 직전 최종 재고 확인
- 재고 차감 시점: 결제 전
- 재고 부족 시: 주문 전체 취소

#### 3.2.3 잔액 기반 결제
- 사용자는 미리 잔액 충전
- 결제 시 잔액에서 차감

#### 3.2.4 쿠폰 할인 적용
- 쿠폰 발급:
  - 한정된 수량으로 발급
  - 선착순 발급 방식
  - 사용자당 동일 쿠폰 1개만 발급 가능
- 쿠폰 사용:
  - 한 주문 상품에 1개 쿠폰만 사용 가능
  - 사용 조건 없음 (최소 금액 제한 등 없음)
- 쿠폰 속성:
  - 정액 할인 (예: 5000원 할인)
  - 만료일 존재

### 3.3 데이터 연동

#### 3.3.1 주문 데이터 외부 전송
- 주문 완료 직후 외부 데이터 플랫폼으로 전송

## 4. 비기능적 요구사항

### 4.1 성능 요구사항

#### 4.1.1 인기 상품 갱신
- 실시간에 최대한 가깝게 갱신

### 4.2 동시성 제어

#### 4.2.1 재고 동시성 처리
- 여러 사용자가 동시 주문 시 선착순 처리
- 먼저 결제 완료한 사용자 주문 성공
- 재고 소진 후 주문한 사용자 주문 실패

#### 4.2.2 쿠폰 발급 동시성 처리
- 선착순 방식으로 한정된 수량만 발급
- 동시 발급 요청 시 정확한 수량 제어

### 4.3 트랜잭션 처리

#### 4.3.1 결제 트랜잭션
- 잔액 차감 실패 시 트랜잭션 롤백
- 재고 차감 실패 시 트랜잭션 롤백

### 4.4 신뢰성

#### 4.4.1 장바구니 항목 제거
- 장바구니 항목 제거 실패 시에도 주문은 정상 처리
- 실패 시:
    - 실패 로그 기록
    - 별도 실패 기록 테이블에 저장
    - 추후 수동 또는 자동 재처리 가능

#### 4.4.2 외부 전송 실패 처리
- 전송 실패 시에도 주문은 정상 처리
- 전송 실패 시 재시도 수행
- 재시도 실패 시:
  - 실패 로그 기록
  - 별도 실패 기록 테이블에 저장
  - 추후 수동 또는 자동 재처리 가능
