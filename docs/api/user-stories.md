# 사용자 스토리

## 1. 상품 조회

### 1.1 상품 목록 조회

**사용자 스토리**
> 고객으로서, 상품 목록을 다양한 정렬 옵션으로 확인하고 싶습니다.

**인수 테스트 시나리오**

#### 시나리오 1: 최신순으로 상품 목록 조회
```
Given: 고객이 메인 페이지에 접속했을 때
When: 상품 목록 API를 호출하고 정렬 옵션을 "최신순"으로 요청
Then: 등록일 기준 최신 상품 20개가 반환됨
And: 재고가 0인 상품도 포함되어 표시됨
```

**화면 전환 플로우**
1. 메인 페이지 진입
2. 상품 목록 조회 API 호출 (정렬: 최신순, 사이즈: 20)
3. 상품 목록 렌더링


#### 시나리오 2: 무한 스크롤 - 추가 상품 로드
```
Given: 고객이 상품 목록을 스크롤하여 하단에 도달했을 때
When: 다음 데이터 로드 요청
Then: 다음 커서 기준으로 추가 20개 상품이 반환됨
And: 기존 목록 하단에 추가로 렌더링됨
```

**화면 전환 플로우**
1. 스크롤이 하단에 도달
2. 상품 목록 조회 API 호출 (커서: 마지막 상품 ID, 사이즈: 20)
3. 추가 상품을 기존 목록 하단에 렌더링

---

### 1.2 상품 상세 조회

**사용자 스토리**
> 고객으로서, 관심있는 상품의 상세 정보를 확인하고 싶습니다.

**인수 테스트 시나리오**

#### 시나리오 1: 상품 상세 조회
```
Given: 고객이 상품 목록에서 특정 상품을 클릭했을 때
When: 상품 상세 API를 호출
Then: 상품의 기본 정보(이름, 가격, 재고)가 반환됨
And: 재고가 0인 경우 "품절" 표시
```

**화면 전환 플로우**
1. 상품 목록에서 상품 클릭
2. 상품 상세 페이지로 이동
3. 상품 상세 조회 API 호출
4. 상품 상세 정보 렌더링

---

### 1.3 실시간 재고 확인

**사용자 스토리**
> 고객으로서, 구매하려는 상품의 현재 재고를 실시간으로 확인하고 싶습니다.

**인수 테스트 시나리오**

#### 시나리오 1: 상품 재고 확인
```
Given: 고객이 상품 상세 페이지에 있을 때
When: 재고 확인 API를 호출
Then: 해당 상품의 현재 재고 수량이 실시간으로 반환됨
And: 재고가 0인 경우 "품절" 표시
```

**화면 전환 플로우**
1. 상품 상세 페이지 진입
2. 재고 확인 API 호출
3. 실시간 재고 수량 표시

---

### 1.4 인기 상품 조회

**사용자 스토리**
> 고객으로서, 최근 인기있는 상품을 빠르게 확인하고 싶습니다.

**인수 테스트 시나리오**

#### 시나리오 1: 메인 페이지에서 인기 상품 조회
```
Given: 고객이 메인 페이지에 접속했을 때
When: 인기 상품 API를 호출
Then: 최근 3일간 판매량 기준 상위 5개 상품이 반환됨
And: 각 상품의 정보(순위, 이름, 가격, 재고)가 함께 표시됨
```

**화면 전환 플로우**
1. 메인 페이지 접속
2. 인기 상품 조회 API 호출 (기본 5개)
3. 인기 상품 배너/섹션에 렌더링

#### 시나리오 2: 인기 상품에서 상세 페이지로 이동
```
Given: 고객이 인기 상품 목록을 확인했을 때
When: 특정 인기 상품 클릭
Then: 해당 상품의 상세 페이지로 이동
```

**화면 전환 플로우**
1. 인기 상품에서 특정 상품 클릭
2. 상품 상세 페이지로 이동
3. 상품 상세 조회 API 호출
4. 상품 상세 정보 렌더링

---

## 2. 주문/결제 프로세스

### 2.1 장바구니에 상품 추가

**사용자 스토리**
> 고객으로서, 구매하고 싶은 상품을 장바구니에 담고 싶습니다.

**인수 테스트 시나리오**

#### 시나리오 1: 재고가 있는 상품 장바구니 담기
```
Given: 고객이 상품 상세 페이지에서 수량을 선택했을 때
When: 장바구니 추가 버튼 클릭
Then: 재고 확인 후 장바구니에 상품이 추가됨
And: 장바구니 아이콘에 담긴 상품 개수가 표시됨
```

**화면 전환 플로우**
1. 상품 상세 페이지에서 수량 입력
2. 장바구니 추가 버튼 클릭
3. 장바구니 추가 API 호출
4. 서버에서 재고 확인
5. 재고 있으면 장바구니 추가 성공
6. 장바구니 개수 업데이트

#### 시나리오 2: 재고 부족 상품 장바구니 담기 실패
```
Given: 고객이 재고가 부족한 상품을 선택했을 때
When: 장바구니 추가 버튼 클릭
Then: "재고가 부족합니다" 알림 표시
And: 장바구니에 추가되지 않음
```

**화면 전환 플로우**
1. 장바구니 추가 API 호출
2. 서버에서 재고 확인
3. 재고 부족 응답
4. 재고 부족 알림 표시

---

### 2.2 장바구니 조회 및 수정

**사용자 스토리**
> 고객으로서, 장바구니에 담긴 상품을 확인하고 수량을 조절하고 싶습니다.

**인수 테스트 시나리오**

#### 시나리오 1: 장바구니 목록 조회
```
Given: 고객이 장바구니 아이콘을 클릭했을 때
When: 장바구니 페이지로 이동
Then: 담긴 상품 목록과 각 상품의 수량, 가격이 표시됨
And: 총 주문 금액이 표시됨
```

**화면 전환 플로우**
1. 장바구니 아이콘 클릭
2. 장바구니 조회 API 호출
3. 장바구니 상품 목록 렌더링

#### 시나리오 2: 장바구니 수량 수정
```
Given: 고객이 장바구니 페이지에서 특정 상품의 수량을 변경했을 때
When: 수량 변경 버튼 클릭 (+/- 버튼)
Then: 해당 상품의 수량이 업데이트됨
And: 총 주문 금액이 재계산됨
```

**화면 전환 플로우**
1. 수량 변경 버튼 클릭
2. 장바구니 수량 수정 API 호출 (새로운 수량)
3. 재고 확인
4. 수량 업데이트 성공
5. 총 금액 재계산 및 렌더링

---

### 2.3 주문하기 - 재고 확인

**사용자 스토리**
> 고객으로서, 장바구니의 상품을 주문하기 전에 재고를 최종 확인하고 싶습니다.

**인수 테스트 시나리오**

#### 시나리오 1: 재고 충분 - 주문 진행
```
Given: 고객이 장바구니 페이지에서 주문하기 버튼을 클릭했을 때
When: 서버에서 모든 상품의 재고를 확인
Then: 모든 상품의 재고가 충분함
And: 쿠폰 선택 페이지로 이동
```

**화면 전환 플로우**
1. 주문하기 버튼 클릭
2. 주문 재고 검증 API 호출 (장바구니 상품 목록)
3. 서버에서 각 상품의 재고 확인
4. 재고 확인 성공
5. 쿠폰 선택 페이지로 이동

#### 시나리오 2: 재고 부족 - 주문 실패
```
Given: 고객이 주문하기 버튼을 클릭했을 때
When: 서버에서 재고를 확인하니 일부 상품의 재고가 부족함
Then: "재고가 부족한 상품이 있습니다" 알림 표시
And: 재고 부족 상품 목록 표시
And: 장바구니 페이지에 머무름
```

**화면 전환 플로우**
1. 주문하기 버튼 클릭
2. 주문 재고 검증 API 호출
3. 재고 부족 응답 (재고 부족 상품 목록 포함)
4. 재고 부족 알림 모달 표시
5. 장바구니 페이지 유지

---

### 2.4 쿠폰 선택 및 적용

**사용자 스토리**
> 고객으로서, 보유한 쿠폰을 선택하여 할인을 받고 싶습니다.

**인수 테스트 시나리오**

#### 시나리오 1: 사용 가능한 쿠폰 조회
```
Given: 고객이 쿠폰 선택 페이지에 진입했을 때
When: 보유 쿠폰 목록 API 호출
Then: 사용 가능한 쿠폰 목록이 표시됨
And: 만료된 쿠폰은 비활성화 표시됨
```

**화면 전환 플로우**
1. 쿠폰 선택 페이지 진입
2. 사용자 쿠폰 목록 조회 API 호출
3. 사용 가능한 쿠폰 목록 렌더링

#### 시나리오 2: 쿠폰 적용 및 할인 금액 계산
```
Given: 고객이 쿠폰을 선택했을 때
When: 쿠폰 적용 버튼 클릭
Then: 쿠폰이 적용되어 할인된 최종 금액이 계산됨
And: 할인 전/후 금액이 모두 표시됨
```

**화면 전환 플로우**
1. 쿠폰 선택
2. 주문 금액 계산 API 호출 (쿠폰ID, 장바구니 정보)
3. 서버에서 할인 금액 계산
4. 할인 전/후 금액 표시
5. 결제 페이지로 이동 버튼 활성화

#### 시나리오 3: 쿠폰 미적용 주문
```
Given: 고객이 쿠폰을 선택하지 않았을 때
When: 쿠폰 없이 계속하기 버튼 클릭
Then: 원래 금액 그대로 결제 페이지로 이동
```

**화면 전환 플로우**
1. 쿠폰 없이 계속하기 클릭
2. 결제 페이지로 이동

---

### 2.5 결제 처리

**사용자 스토리**
> 고객으로서, 잔액으로 안전하게 결제하고 싶습니다.

**인수 테스트 시나리오**

#### 시나리오 1: 잔액 충분 - 결제 성공
```
Given: 고객이 결제 페이지에서 결제하기 버튼을 클릭했을 때
And: 고객의 잔액이 주문 금액보다 많을 때
When: 결제 API 호출
Then: 재고 최종 확인 → 잔액 차감 → 재고 차감 → 주문 완료 처리
And: 주문 완료 페이지로 이동
And: 백그라운드에서 외부 데이터 플랫폼으로 주문 정보 전송
```

**화면 전환 플로우**
1. 결제하기 버튼 클릭
2. 결제 처리 API 호출
   - 재고 최종 확인
   - 잔액 차감
   - 재고 차감
   - 주문 생성
   - 쿠폰 사용 처리
3. 결제 성공 응답
4. 비동기로 외부 데이터 플랫폼 전송
5. 주문 완료 페이지로 이동

#### 시나리오 2: 잔액 부족 - 결제 실패
```
Given: 고객이 결제하기 버튼을 클릭했을 때
And: 고객의 잔액이 주문 금액보다 적을 때
When: 결제 API 호출
Then: "잔액이 부족합니다" 알림 표시
And: 결제가 진행되지 않음
```

**화면 전환 플로우**
1. 결제하기 버튼 클릭
2. 결제 처리 API 호출
3. 잔액 부족 응답
4. 잔액 부족 알림 표시
5. 결제 페이지 유지

#### 시나리오 3: 결제 중 재고 부족 - 결제 실패
```
Given: 고객이 결제하기 버튼을 클릭했을 때
And: 동시에 다른 사용자가 같은 상품을 먼저 구매하여 재고가 소진됨
When: 결제 처리 중 재고 최종 확인
Then: "재고가 부족합니다" 알림 표시
And: 결제가 취소됨
And: 장바구니 페이지로 이동
```

**화면 전환 플로우**
1. 결제하기 버튼 클릭
2. 결제 처리 API 호출
3. 재고 최종 확인에서 재고 부족 발견
4. 재고 부족 응답
5. 재고 부족 알림 표시
6. 장바구니 페이지로 리다이렉트

---

### 2.6 주문 완료 및 조회

**사용자 스토리**
> 고객으로서, 주문이 정상적으로 완료되었는지 확인하고 싶습니다.

**인수 테스트 시나리오**

#### 시나리오 1: 주문 완료 확인
```
Given: 결제가 성공적으로 완료되었을 때
When: 주문 완료 페이지에 접속
Then: 주문 번호, 주문 상품, 결제 금액, 사용한 쿠폰 등이 표시됨
And: 주문 상태가 "주문 완료"로 표시됨
```

**화면 전환 플로우**
1. 결제 완료 후 주문 완료 페이지로 리다이렉트
2. 주문 상세 조회 API 호출
3. 주문 상세 정보 렌더링

---

### 2.7 외부 데이터 플랫폼 전송

**시스템 동작**
> 주문 완료 후 외부 데이터 플랫폼으로 주문 정보를 전송합니다.

**처리 시나리오**

#### 시나리오 1: 데이터 전송 성공
```
Given: 주문이 완료되었을 때
When: 백그라운드에서 외부 데이터 플랫폼으로 전송
Then: 전송 성공
And: 전송 로그 기록
```

#### 시나리오 2: 데이터 전송 실패 후 재시도 성공
```
Given: 주문이 완료되고 데이터 전송을 시도했을 때
When: 첫 번째 전송 실패
Then: 자동 재시도 수행
And: 재시도에서 전송 성공
And: 전송 로그 기록
```

#### 시나리오 3: 재시도 실패 - 별도 테이블 저장
```
Given: 주문이 완료되고 데이터 전송을 시도했을 때
When: 모든 재시도가 실패
Then: 실패 로그 기록
And: 실패 기록 테이블에 저장
And: 추후 재처리를 위해 데이터 보관
And: 주문은 정상 완료 상태 유지
```
